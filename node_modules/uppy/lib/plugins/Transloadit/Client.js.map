{"version":3,"sources":["../../../src/plugins/Transloadit/Client.js"],"names":["module","exports","opts","apiUrl","createAssembly","templateId","params","fields","signature","expectedFiles","data","FormData","append","JSON","stringify","Object","keys","forEach","key","fetch","method","body","then","response","json","assembly","error","Error","message","code","status","getAssemblyStatus","url"],"mappings":";;;;AAAA;;;AAGAA,OAAOC,OAAP;AACE,oBAAwB;AAAA,QAAXC,IAAW,uEAAJ,EAAI;;AAAA;;AACtB,SAAKC,MAAL,GAAc,8BAAd;AACA,SAAKD,IAAL,GAAYA,IAAZ;AACD;;AAED;;;;;;;AANF,mBAWEE,cAXF,iCAiBK;AAAA,QALDC,UAKC,QALDA,UAKC;AAAA,QAJDC,MAIC,QAJDA,MAIC;AAAA,QAHDC,MAGC,QAHDA,MAGC;AAAA,QAFDC,SAEC,QAFDA,SAEC;AAAA,QADDC,aACC,QADDA,aACC;;AACD,QAAMC,OAAO,IAAIC,QAAJ,EAAb;AACAD,SAAKE,MAAL,CAAY,QAAZ,EAAsB,OAAON,MAAP,KAAkB,QAAlB,GAClBA,MADkB,GAElBO,KAAKC,SAAL,CAAeR,MAAf,CAFJ;AAGA,QAAIE,SAAJ,EAAe;AACbE,WAAKE,MAAL,CAAY,WAAZ,EAAyBJ,SAAzB;AACD;;AAEDO,WAAOC,IAAP,CAAYT,MAAZ,EAAoBU,OAApB,CAA4B,UAACC,GAAD,EAAS;AACnCR,WAAKE,MAAL,CAAYM,GAAZ,EAAiBX,OAAOW,GAAP,CAAjB;AACD,KAFD;AAGAR,SAAKE,MAAL,CAAY,+BAAZ,EAA6CH,aAA7C;;AAEA,WAAOU,MAAS,KAAKhB,MAAd,kBAAmC;AACxCiB,cAAQ,MADgC;AAExCC,YAAMX;AAFkC,KAAnC,EAGJY,IAHI,CAGC,UAACC,QAAD;AAAA,aAAcA,SAASC,IAAT,EAAd;AAAA,KAHD,EAGgCF,IAHhC,CAGqC,UAACG,QAAD,EAAc;AACxD,UAAIA,SAASC,KAAb,EAAoB;AAClB,YAAMA,QAAQ,IAAIC,KAAJ,CAAUF,SAASG,OAAnB,CAAd;AACAF,cAAMG,IAAN,GAAaJ,SAASC,KAAtB;AACAA,cAAMI,MAAN,GAAeL,QAAf;AACA,cAAMC,KAAN;AACD;;AAED,aAAOD,QAAP;AACD,KAZM,CAAP;AAaD,GA5CH;;AA8CE;;;;;;;AA9CF,mBAmDEM,iBAnDF,8BAmDqBC,GAnDrB,EAmD0B;AACtB,WAAOb,MAAMa,GAAN,EACJV,IADI,CACC,UAACC,QAAD;AAAA,aAAcA,SAASC,IAAT,EAAd;AAAA,KADD,CAAP;AAED,GAtDH;;AAAA;AAAA","file":"Client.js","sourcesContent":["/**\n * A Barebones HTTP API client for Transloadit.\n */\nmodule.exports = class Client {\n  constructor (opts = {}) {\n    this.apiUrl = 'https://api2.transloadit.com'\n    this.opts = opts\n  }\n\n  /**\n   * Create a new assembly.\n   *\n   * @param {object} options\n   */\n  createAssembly ({\n    templateId,\n    params,\n    fields,\n    signature,\n    expectedFiles\n  }) {\n    const data = new FormData()\n    data.append('params', typeof params === 'string'\n      ? params\n      : JSON.stringify(params))\n    if (signature) {\n      data.append('signature', signature)\n    }\n\n    Object.keys(fields).forEach((key) => {\n      data.append(key, fields[key])\n    })\n    data.append('tus_num_expected_upload_files', expectedFiles)\n\n    return fetch(`${this.apiUrl}/assemblies`, {\n      method: 'post',\n      body: data\n    }).then((response) => response.json()).then((assembly) => {\n      if (assembly.error) {\n        const error = new Error(assembly.message)\n        error.code = assembly.error\n        error.status = assembly\n        throw error\n      }\n\n      return assembly\n    })\n  }\n\n  /**\n   * Get the current status for an assembly.\n   *\n   * @param {string} url The status endpoint of the assembly.\n   */\n  getAssemblyStatus (url) {\n    return fetch(url)\n      .then((response) => response.json())\n  }\n}\n"]}